<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å¼€å‘è€…åˆ›ä½œä¸­å¿ƒ</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* å¼€å‘è€…ä¸­å¿ƒä¸“å±æ ·å¼ */
        /* å¤©ç©ºä¸»é¢˜é…è‰² */
body {
    background: linear-gradient(150deg, #f0f9ff 0%, #9bcff7 80%);
    min-height: 100vh;
}

.dev-container {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    box-shadow: 0 12px 40px rgba(173, 216, 230, 0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

/* äº‘æœµåŠ¨æ€èƒŒæ™¯ */
.cloud-bg {
    position: fixed;
    width: 200%;
    height: 100%;
    z-index: 0;
    background: url('data:image/svg+xml,\<svg width="100" height="60" viewBox="0 0 100 60" xmlns="http://www.w3.org/2000/svg">\<path fill="%23ffffff" opacity="0.4" d="M23.8 22c-4.8 0-8.7-3.9-8.7-8.7 0-4.8 3.9-8.7 8.7-8.7 2.2 0 4.2.8 5.8 2.2-.3-1.2-.5-2.5-.5-3.8C29.1 3.1 33.2 0 38 0c3.5 0 6.6 1.9 8.3 4.7 1.5-1.4 3.4-2.2 5.5-2.2 4.3 0 7.8 3.5 7.8 7.8 0 .8-.1 1.6-.3 2.4 2.9 1.9 4.8 5.1 4.8 8.8 0 5.7-4.6 10.3-10.3 10.3H23.8z"/>\</svg>') repeat-x;
    background-size: auto 300px; /* æ§åˆ¶äº‘æœµå¤§å° */
    animation: cloudMove 120s linear infinite; /* è°ƒæ…¢é€Ÿåº¦ */
}

@keyframes cloudMove {
    from { background-position: 100% 0; }  /* ä»å³ä¾§å¼€å§‹ */
    to { background-position: -100% 0; }   /* ç§»åŠ¨åˆ°å·¦ä¾§ */
}


        .dev-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 30px;
            background: rgba(0,0,0,0.8);
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.5);
        }

        .game-type-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .type-card {
            background: #1a1a1a;
            padding: 25px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .type-card:hover {
            transform: translateY(-5px);
            border-color: #ff6b6b;
            box-shadow: 0 5px 15px rgba(255,107,107,0.3);
        }

        .type-card.active {
            border-color: #00ff88;
            background: linear-gradient(45deg, #1a1a1a, #2a2a2a);
        }

        .game-form {
            display: none;
            background: #2a2a2a;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #00ff88;
            font-size: 16px;
        }

        .cover-preview {
            width: 300px;
            height: 180px;
            border: 2px dashed #666;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .cover-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .tag-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tag-item {
            background: #333;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tag-item.selected {
            background: #00ff88;
            color: #1a1a1a;
        }

        #submitBtn {
            background: linear-gradient(45deg, #00ff88, #00ccff);
            padding: 10px 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            border-radius: 30px;
            color: #1a1a1a;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
            min-width: 120px;
            box-shadow: 0 4px 15px rgba(41, 182, 246, 0.3);
        }

        #submitBtn:hover {
            transform: scale(1.02);
        }
    </style>
        <link rel="stylesheet" href="./shouye.css">
</head>
<body>

    <header>
        <div class="logo"><img src="img/logo.png" height="49" width="156"/></div>
        <div class="topbq">
            <ul>
                <li><a href="#" class="top-bq" style="color: orange">é¢„çº¦</a></li>
                <li><a href="ceshi.html" class="top-bq">è®¢é˜…</a></li>
                <li><a href="#" class="top-bq">ç¤¾åŒº</a></li>
                <li class="dropdown-container">
                    <a href="#" class="top-bq">æ›´å¤š â–¼</a>
                    <div class="dropdown-menu">
                        <div class="dropdown-item" onclick="showNotifications()">ğŸ“© é€šçŸ¥</div>
                        <div class="dropdown-item" onclick="showSettings()">âš™ï¸ è®¾ç½®</div>
                        <!-- å¼€å‘è€…ä¸“å± -->
                        <div class="dev-item" onclick="location.href='kaifa.html'">ğŸ’» å¼€å‘è€…ä¸­å¿ƒ</div>
                    </div>
                </li>
            </ul>
        </div>
        <div class="search-bar">
            <input type="text" placeholder="æœç´¢..." style="height: 30px;width: 350px;border-top-left-radius: 15px;border-bottom-left-radius: 15px;border: none;background: whitesmoke">
            <button style="margin-left:-10px;height: 40px;width: 60px;border-bottom-right-radius:15px;border-top-right-radius:15px;border: none;background: whitesmoke;color: black ">æœç´¢</button>
        </div>
        <div class="login">
            <a href="library.html">
            <button type="download"  >æˆ‘çš„æ¸¸æˆåº“</button>
            </a>
        </div>
    </header>
    <div style="height: 65px;width: 100%"></div>
    <div class="cloud-bg"></div>
    <div class="dev-container">
        <h1 style="color: #00ff88; text-align: center; margin-bottom: 40px;">ğŸ® æ¸¸æˆåˆ›ä½œä¸­å¿ƒ</h1>
        
        <div class="game-type-selector">
            <div class="type-card" onclick="selectType('reserve')">
                <h3>é¢„çº¦æ¸¸æˆ</h3>
                <p>é€‚ç”¨äºæœªå‘å¸ƒçš„æ¸¸æˆï¼Œé€šè¿‡å®¡æ ¸åå°†æ˜¾ç¤ºåœ¨é¢„çº¦é¡µé¢</p>
            </div>
            <div class="type-card" onclick="selectType('subscribe')">
                <h3>è®¢é˜…æ¸¸æˆ</h3>
                <p>é€‚ç”¨äºå·²å‘å¸ƒæ¸¸æˆï¼Œé€šè¿‡å®¡æ ¸åæ˜¾ç¤ºåœ¨è®¢é˜…é¡µé¢</p>
            </div>
        </div>

        <form id="gameForm" class="game-form">
            <div class="form-group">
                <label>æ¸¸æˆåç§°</label>
                <input type="text" id="gameTitle" required>
            </div>

            <div class="form-group">
                <label>æ¸¸æˆæè¿°</label>
                <textarea id="gameDesc" rows="4" required></textarea>
            </div>

            <div class="form-group">
                <label>ä¸Šä¼ å°é¢</label>
                <div class="cover-preview" onclick="document.getElementById('coverInput').click()">
                    <img id="coverPreview" src="img/upload_placeholder.png">
                </div>
                <input type="file" id="coverInput" hidden accept="image/*">
            </div>

            <!-- <div class="form-group">
                <label>é€‰æ‹©æ ‡ç­¾</label>
                <div class="tag-selector" id="tagContainer">
                    <div class="tag-item" data-tag="å†’é™©">å†’é™©</div>
                    <div class="tag-item" data-tag="è§’è‰²æ‰®æ¼”">è§’è‰²æ‰®æ¼”</div>
                    <div class="tag-item" data-tag="ç­–ç•¥">ç­–ç•¥</div>
                    <div class="tag-item" data-tag="å¤šäººåˆä½œ">å¤šäººåˆä½œ</div>
                </div>
            </div> -->
            <div class="form-group">
                <label>æ¸¸æˆæ ‡ç­¾ï¼ˆæœ€å¤š3ä¸ªï¼‰</label>
                <div class="tag-selector" id="tagContainer"></div>
              </div>

            <button type="button" id="submitBtn" onclick="submitGame()">æäº¤å®¡æ ¸</button>
        </form>
    </div>

   
</body>
<script>
    // ç±»å‹å¡ç‰‡åˆ‡æ¢é€»è¾‘
    document.querySelectorAll('.type-card').forEach(card => {
            card.addEventListener('click', function() {
                const isActive = this.classList.contains('active');
                document.querySelectorAll('.type-card').forEach(c => c.classList.remove('active'));
                this.classList.toggle('active', !isActive);
                document.getElementById('gameForm').style.display = isActive ? 'none' : 'block';
            });
        });
    // å°é¢é¢„è§ˆ
    document.getElementById('coverInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('coverPreview').src = e.target.result;
        }
        reader.readAsDataURL(file);
    });

    // æ ‡ç­¾é€‰æ‹©
    document.querySelectorAll('.tag-item').forEach(tag => {
        tag.addEventListener('click', function() {
            this.classList.toggle('selected');
        });
    });
            // åˆå§‹åŒ–æ ‡ç­¾é€‰æ‹©
        async function initTags() {
          const res = await fetch('/api/tags');
          const tags = await res.json();
          const container = document.getElementById('tagContainer');
        
          tags.forEach(tag => {
            const div = document.createElement('div');
            div.className = 'tag-item';
            div.textContent = tag.name;
            div.dataset.tagId = tag.id;
            div.onclick = () => toggleTag(tag.id);
            container.appendChild(div);
          });
        }

        let selectedTags = [];
        function toggleTag(tagId) {
          const index = selectedTags.indexOf(tagId);
          if (index > -1) {
            selectedTags.splice(index, 1);
          } else if (selectedTags.length < 3) {
            selectedTags.push(tagId);
          }
          updateTagDisplay();
        }
    // æäº¤æ¸¸æˆ
    async function submitGame() {
            const gameTitle = document.getElementById('gameTitle').value;
            const gameDesc = document.getElementById('gameDesc').value;
            
            // åŸºç¡€éªŒè¯
            if (!gameTitle || gameTitle.length < 5) {
                alert('æ¸¸æˆåç§°éœ€è‡³å°‘5ä¸ªå­—ç¬¦');
                return;
            }

            if (!gameDesc || gameDesc.length < 20) {
                alert('æ¸¸æˆæè¿°éœ€è‡³å°‘20ä¸ªå­—ç¬¦');
                return;
            }

            const gameData = {
                title: gameTitle,
                desc: gameDesc,
                type: document.querySelector('.type-card.active')?.dataset.type, // é€šè¿‡data-typeè·å–ç±»å‹
                tags: [...document.querySelectorAll('.tag-item.selected')].map(t => t.dataset.tag),
                cover: document.getElementById('coverPreview').src
            };

            try {
                const response = await fetch('/api/submit-game', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify(gameData)
                });

                const result = await response.json();
                
                if(response.ok) {
                    alert('âœ… æäº¤æˆåŠŸï¼å®¡æ ¸ç»“æœå°†é€šè¿‡ç«™å†…ä¿¡é€šçŸ¥');
                    resetForm();
                    // å®é™…å¼€å‘ä¸­åº”è·³è½¬åˆ°å®¡æ ¸åˆ—è¡¨é¡µ
                } else {
                    alert(`âŒ æäº¤å¤±è´¥: ${result.message}`);
                }
            } catch (error) {
                console.error('æäº¤é”™è¯¯:', error);
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            }
        }
        function setupValidation() {
            document.getElementById('gameTitle').addEventListener('input', function(e) {
                const isValid = e.target.value.length >= 5;
                this.style.border = isValid ? '2px solid #00ff88' : '2px solid #ff6b6b';
            });

            document.getElementById('gameDesc').addEventListener('input', function(e) {
                const isValid = e.target.value.length >= 20;
                this.style.border = isValid ? '2px solid #00ff88' : '2px solid #ff6b6b';
            });
        }
    function resetForm() {
        document.getElementById('gameForm').reset();
        document.getElementById('coverPreview').src = 'img/upload_placeholder.png';
        document.querySelectorAll('.tag-item').forEach(t => t.classList.remove('selected'));
    }
    // åŠ¨æ€è¡¨å•éªŒè¯
    document.getElementById('gameTitle').addEventListener('input', function(e) {
        this.style.borderColor = e.target.value.length > 4 ? '#4fc3f7' : '#ff6b6b';
    });
    
    // æ–‡ä»¶ä¸Šä¼ ç¾åŒ–
    document.getElementById('coverInput').addEventListener('change', function(e) {
        const fileName = e.target.files[0]?.name || 'æœªé€‰æ‹©æ–‡ä»¶';
        document.querySelector('.cover-preview').setAttribute('data-text', fileName);
    });
</script>
</html>