<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>é¦–é¡µ</title>
    <link rel="stylesheet" href="./shouye.css">
</head>
<body>
<header>
    <div class="logo"><img src="img/logo.png" height="49" width="156"/></div>
    <div class="topbq">
        <ul>
            <li><a href="#" class="top-bq" style="color: orange">é¢„çº¦</a></li>
            <li><a href="ceshi.html" class="top-bq">è®¢é˜…</a></li>
            <li><a href="#" class="top-bq">ç¤¾åŒº</a></li>
            <li class="dropdown-container">
                <a href="#" class="top-bq">æ›´å¤š â–¼</a>
                <div class="dropdown-menu">
                    <div class="dropdown-item" onclick="showNotifications()">ğŸ“© é€šçŸ¥</div>
                    <div class="dropdown-item" onclick="showSettings()">âš™ï¸ è®¾ç½®</div>
                    <!-- å¼€å‘è€…ä¸“å± -->
                    <div class="dev-item" onclick="checkDeveloperAccess(event)">ğŸ’» å¼€å‘è€…ä¸­å¿ƒ</div>
                </div>
            </li>
        </ul>
    </div>
    <div class="search-bar">
        <input type="text" placeholder="æœç´¢..." style="height: 30px;width: 350px;border-top-left-radius: 15px;border-bottom-left-radius: 15px;border: none;background: whitesmoke">
        <button style="margin-left:-10px;height: 40px;width: 60px;border-bottom-right-radius:15px;border-top-right-radius:15px;border: none;background: whitesmoke;color: black ">æœç´¢</button>
    </div>
    <div class="login">
        <a href="library.html">
        <button type="download"  >æˆ‘çš„æ¸¸æˆåº“</button>
        </a>
    </div>
</header>
<div style="height: 65px;width: 100%"></div>
<div class="body1">

        <div class="carousel">
            <div class="slides">
                <div class="slide" id="slide0">
                    <img src="./img/lunbo1.png" alt="å›¾ç‰‡1" height="706" width="100%"/>
                </div>
                <div class="slide" id="slide1">
                    <img src="./img/lunbo2.png" alt="å›¾ç‰‡2" height="706" width="100%">
                </div>
                <div class="slide" id="slide2">
                    <img src="./img/lunbo3.png" alt="å›¾ç‰‡3" height="706" width="100%">
                </div>
            </div>

            <div class="controls">
                <button class="control-button" id="prev">â®</button>
                <button class="control-button" id="next">â¯</button>
            </div>
        </div>
</div>
<div class="body2">
    <div class="b2">
        <div class="b2-1">
            æ–°æ¸¸å‘å¸ƒ
        </div>
        <div class="b2-2">
            <div class="b2-2a">
                <div class="date1">
                    <div class="date2">11.21</div>
                </div>
                <div class="date3"><img src="img/date1.png" height="327" width="185"/>
                    <div class="hd1" style="top: 0">
                        <div class="hover-div">
                            <video autoplay muted loop  width="300" style="margin-top: 0">
                                <source src="./video/date1.mp4" type="video/mp4">
                             </video>
                        <div class="h1" ><font size="4px">æ— å°½æ¢¦å›</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font size="3px" color="#ff4500"><b>å¥½è¯„ç‡ï¼š58%</b></font>
                        </div>
                            <br>
                            <div class="h2"><font size="1">roguelike</font></div>
                            <div class="h2"><font size="1">äºŒæ¬¡å…ƒ</font></div>
                            <div class="h2"><font size="1">å†’é™©RPG</font></div>
                            <div class="h2"><font size="1">çˆ½å¿«æ‰‹æ„Ÿ</font></div>
                            <br>
                            <div style="padding-left: 5px;box-sizing: border-box"><font size="2" color="#d3d3d3">2024-11-24ä¸Šçº¿</font></div>
                            <div style="padding-left: 5px;box-sizing: border-box"><font size="2" color="#d3d3d3">å¤šè§’è‰²åŠ¨ä½œå‰²è‰çˆ½æ¸¸</font></div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="b2-2a">
                <div class="date1">
                    <div class="date2">11.22</div>
                </div>
                <div class="date3-1"><img class="" src="img/date2.png" height="327" width="185"/>

                        <div class="hover-div2">
                            <div class="hd1"  style="top: 0">
                            <video autoplay muted loop  width="300" style="margin-top: 0">
                                <source src="./video/date2.mp4" type="video/mp4">
                            </video>
                                <div class="h1" ><font size="4px">å­¤è¡Œå¼‚æ˜Ÿ</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font size="3px" color="#ff4500"><b>å¥½è¯„ç‡ï¼š58%</b></font>
                                </div>
                                <br>
                                <div class="h2"><font size="1">æœ¬åœ°åˆä½œ</font></div>
                                <div class="h2"><font size="1">ä¼‘é—²</font></div>
                                <div class="h2"><font size="1">ç§‘å¹»</font></div>
                                <div class="h2"><font size="1">çˆ½å¿«æ‰‹æ„Ÿ</font></div>
                                <br>
                                <div style="padding-left: 5px;box-sizing: border-box"><font size="2" color="#d3d3d3">2024-11-22ä¸Šçº¿</font></div>
                                <div style="padding-left: 5px;box-sizing: border-box"><font size="2" color="#d3d3d3">åŒå±åœ¨çº¿åˆä½œèµ›è½¦æ¸¸æˆ</font></div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="b2-2a">
                <div class="date1">
                    <div class="date2">11.25</div>
                </div>
                <div class="date3-3"><img class="" src="img/date3.png" height="327" width="185"/>
                    <div class="hover-div3">
                        <div class="hd1"  style="top: 0">
                            <video autoplay muted loop  width="300" style="margin-top: 0">
                                <source src="./video/date3.mp4" type="video/mp4">
                            </video>
                            <div class="h1" ><font size="4px">æ°´é“¶ç–—å…»é™¢</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font size="3px" color="#ff4500"><b>å¥½è¯„ç‡ï¼š58%</b></font>
                            </div>
                            <br>
                            <div class="h2"><font size="1">è§£è°œ</font></div>
                            <div class="h2"><font size="1">äºŒæ¬¡å…ƒ</font></div>
                            <div class="h2"><font size="1">å†’é™©RPG</font></div>
                            <div class="h2"><font size="1">ç‹¬ç«‹æ¸¸æˆ</font></div>
                            <br>
                            <div style="padding-left: 5px;box-sizing: border-box"><font size="2" color="#d3d3d3">2024-11-25ä¸Šçº¿</font></div>
                            <div style="padding-left: 5px;box-sizing: border-box"><font size="2" color="#d3d3d3">äºŒæ¬¡å…ƒå†’é™©è§£å¯†ç‹¬ç«‹æ¸¸æˆ</font></div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="b2-2a">
                <div class="date1">
                    <div class="date2">11.28</div>
                </div>
                    <div class="date3-4"><img class="" src="img/date4.png" height="327" width="185"/>
                        <div class="hover-div4">
                            <div class="hd1"  style="top: 0">
                                <video autoplay muted loop  width="300" style="margin-top: 0">
                                    <source src="./video/date4.mp4" type="video/mp4">
                                </video>
                                <div class="h1" ><font size="4px">è½©è¾•ä¼ å¥‡ï¼šè½®å›</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font size="3px" color="#ff4500"><b>å¥½è¯„ç‡ï¼š58%</b></font>
                                </div>
                                <br>
                                <div class="h2"><font size="1">ç¥è¯</font></div>
                                <div class="h2"><font size="1">å›½é£</font></div>
                                <div class="h2"><font size="1">ä»™ä¾ </font></div>
                                <div class="h2"><font size="1">å¤§é€ƒäº¡</font></div>
                                <br>
                                <div style="padding-left: 5px;box-sizing: border-box"><font size="2" color="#d3d3d3">2024-11-28ä¸Šçº¿</font></div>
                                <div style="padding-left: 5px;box-sizing: border-box"><font size="2" color="#d3d3d3">å±±æµ·ç»èƒŒæ™¯PVEç½‘ç»œæ¸¸æˆ</font></div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="b2-2a">
                <div class="date1">
                    <div class="date2">12.04</div>
                </div>
                    <div class="date3-5"><img class="" src="img/date5.png" height="327" width="185"/>
                        <div class="hover-div5">
                            <div class="hd1"  style="top: 0">
                                <video autoplay muted loop  width="300" style="margin-top: 0">
                                    <source src="./video/date5.mp4" type="video/mp4">
                                </video>
                                <div class="h1" ><font size="4px">å®Œè›‹ï¼æˆ‘è¢«ç¾å¥³åŒ…å›´äº†</font><font size="3px" color="#ff4500"><b>å¥½è¯„ç‡ï¼š58%</b></font>
                                </div>
                                <br>
                                <div class="h2"><font size="1">æ‹çˆ±</font></div>
                                <div class="h2"><font size="1">å‰§æƒ…ä¸°å¯Œ</font></div>
                                <div class="h2"><font size="1">æ¨¡æ‹Ÿç”Ÿæ´»</font></div>
                                <div class="h2"><font size="1">é«˜ç”»è´¨</font></div>
                                <br>
                                <div style="padding-left: 5px;box-sizing: border-box"><font size="2" color="#d3d3d3">2024-12-04ä¸Šçº¿</font></div>
                                <div style="padding-left: 5px;box-sizing: border-box"><font size="2" color="#d3d3d3">å…¨åŠ¨æ€çœŸäººäº’åŠ¨ä½œå“</font></div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


<div class="body3">
        <div class="b3">

                <div class="b3-date1">
                    <div class="b3-date2">é¢„çº¦è¿›è¡Œä¸­</div>
                </div>
            <div class="b3-2">
                <div class="b3-2a1">
                    <div class="b3-d3a"><img src="img/yuyue1.png" height="192" width="305"/></div>
                    <div style="display: flex;margin-top: 15px" class="b3-d3b">
                        <div style="width: 60%" class="b3-d3b1">æ³¡å§†æ³¡å§†<br>
                        <span class="reserve-count" data-game-id="game1">0äººé¢„çº¦</span></div>
                        <div class="b3-d3b2">
                            <button type="yuyue" 
                                    class="reserve-btn"
                                    data-game-id="game1" 
                                    data-game-name="æ³¡å§†æ³¡å§†">
                              ç«‹å³é¢„çº¦
                            </button>
                          </div>
                    </div>
                </div>
                <div class="b3-2a">
                    <div class="b3-d3"><img src="img/yuyue2.png" height="192" width="305"/></div>
                    <div style="display: flex;margin-top: 15px" class="b3-d3b">
                        <div style="width: 60%" class="b3-d3b1">æµæ”¾ä¹‹è·¯<br>
                            <span class="reserve-count" data-game-id="game2">0äººé¢„çº¦</span></div>
                        <div class="b3-d3b2">
                            <button type="yuyue" 
                                    class="reserve-btn"
                                    data-game-id="game2" 
                                    data-game-name="æµæ”¾ä¹‹è·¯">
                              ç«‹å³é¢„çº¦
                            </button>
                          </div>
                    </div>
                </div>
                <div class="b3-2a">
                    <div class="b3-d3"><img src="img/yuyue3.png" height="192" width="305"/></div>
                    <div style="display: flex;margin-top: 15px" class="b3-d3b">
                        <div style="width: 60%" class="b3-d3b1">æš—åŒºçªå›´<br> 
                            <span class="reserve-count" data-game-id="game3">0äººé¢„çº¦</span></div>
                        <div class="b3-d3b2">
                            <button type="yuyue" 
                                    class="reserve-btn"
                                    data-game-id="game3" 
                                    data-game-name="æš—åŒºçªå›´">
                              ç«‹å³é¢„çº¦
                            </button>
                          </div>
                    </div>
                </div>
            </div>
            <div style="margin-top: 20px;"></div>
            <div class="b3-2">
                <div class="b3-2a1">
                    <div class="b3-d3"><img src="img/yuyue4.png" height="192" width="305"/></div>
                    <div style="display: flex;margin-top: 15px" class="b3-d3b">
                        <div style="width: 60%" class="b3-d3b1">é‡è›®äººå¤§ä½œæˆ˜2<br>
                            <span class="reserve-count" data-game-id="game4">0äººé¢„çº¦</span></div>
                        <div class="b3-d3b2">
                            <button type="yuyue" 
                                    class="reserve-btn"
                                    data-game-id="game4" 
                                    data-game-name="é‡è›®äººå¤§ä½œæˆ˜2">
                              ç«‹å³é¢„çº¦
                            </button>
                          </div>
                    </div>
                </div>
                <div class="b3-2a">
                    <div class="b3-d3"><img src="img/yuyue5.png" height="192" width="305"/></div>
                    <div style="display: flex;margin-top: 15px" class="b3-d3b">
                        <div style="width: 60%" class="b3-d3b1">æ´›å…‹ç‹å›½ä¸–ç•Œ<br>
                            <span class="reserve-count" data-game-id="game5">0äººé¢„çº¦</span></div>
                        <div class="b3-d3b2">
                            <button type="yuyue" 
                                    class="reserve-btn"
                                    data-game-id="game5" 
                                    data-game-name="æ´›å…‹ç‹å›½ä¸–ç•Œ">
                              ç«‹å³é¢„çº¦
                            </button>
                          </div>
                    </div>
                </div>
                <div class="b3-2a">
                    <div class="b3-d3"><img src="img/yuyue6.png" height="192" width="305"/></div>
                    <div style="display: flex;margin-top: 15px" class="b3-d3b">
                        <div style="width: 60%" class="b3-d3b1">å¼‚äººä¹‹ä¸‹<br>
                            <span class="reserve-count" data-game-id="game6">0äººé¢„çº¦</span></div>
                        <div class="b3-d3b2">
                            <button type="yuyue" 
                                    class="reserve-btn"
                                    data-game-id="game6" 
                                    data-game-name="å¼‚äººä¹‹ä¸‹">
                              ç«‹å³é¢„çº¦
                            </button>
                          </div>
                    </div>
                </div>
            </div>
            <div style="margin-top: 20px;"></div>
            <div class="b3-2">
                <div class="b3-2a1">
                    <div class="b3-d3"><img src="img/yuyue7.png" height="192" width="305"/></div>
                    <div style="display: flex;margin-top: 15px" class="b3-d3b">
                        <div style="width: 60%" class="b3-d3b1">è’é‡èµ·æº<br>
                            <span class="reserve-count" data-game-id="game7">0äººé¢„çº¦</span></div>
                        <div class="b3-d3b2">
                            <button type="yuyue" 
                                    class="reserve-btn"
                                    data-game-id="game7" 
                                    data-game-name="è’é‡èµ·æº">
                              ç«‹å³é¢„çº¦
                            </button>
                          </div>
                    </div>
                </div>
                <div class="b3-2a">
                    <div class="b3-d3"><img src="img/yuyue8.png" height="192" width="305"/></div>
                    <div style="display: flex;margin-top: 15px" class="b3-d3b">
                        <div style="width: 60%" class="b3-d3b1">è¯¸ç¥ç«æŠ€åœº<br>
                          <span class="reserve-count" data-game-id="game8">0äººé¢„çº¦</span></div>
                        <div class="b3-d3b2">
                            <button type="yuyue" 
                                    class="reserve-btn"
                                    data-game-id="game8" 
                                    data-game-name="è¯¸ç¥ç«æŠ€åœº">
                              ç«‹å³é¢„çº¦
                            </button>
                          </div>
                    </div>
                </div>
                <div class="b3-2a">
                    <div class="b3-d3"><img src="img/yuyue9.png" height="192" width="305"/></div>
                    <div style="display: flex;margin-top: 15px" class="b3-d3b">
                        <div style="width: 60%" class="b3-d3b1">èƒœåˆ©å¥³ç¥<br>
                        <span class="reserve-count" data-game-id="game9">0äººé¢„çº¦</span></div>
                        <div class="b3-d3b2">
                            <button type="yuyue" 
                                    class="reserve-btn"
                                    data-game-id="game9" 
                                    data-game-name="èƒœåˆ©å¥³ç¥">
                              ç«‹å³é¢„çº¦
                            </button>
                          </div>
                    </div>
                </div>
            </div>
            <div style="margin-top: 20px;"></div>
            <div class="b3-2">
                <div class="b3-2a1">
                    <div class="b3-d3"><img src="img/yuyue10.png" height="192" width="305"/></div>
                    <div style="display: flex;margin-top: 15px" class="b3-d3b">
                        <div style="width: 60%" class="b3-d3b1">çŸ©é˜µé›¶æ—¥å±æœº<br>
                            <span class="reserve-count" data-game-id="game10">0äººé¢„çº¦</span></div>
                        <div class="b3-d3b2">
                            <button type="yuyue" 
                                    class="reserve-btn"
                                    data-game-id="game10" 
                                    data-game-name="çŸ©é˜µé›¶æ—¥å±æœº">
                              ç«‹å³é¢„çº¦
                            </button>
                          </div>
                    </div>
                </div>
            </div>
    </div>
</div></div>
<!-- <div class="b3-2" id="reservedGamesContainer"></div> -->

<div class="btm">
    <div class="footer-content">
        <div class="footer-column">
            <!-- ä¸‹è½½å®¢æˆ·ç«¯ -->
            <div class="download-section">
                <h3 class="download-header">ä¸‹è½½å®¢æˆ·ç«¯</h3>
                <div class="download-list">
                    <a href="#" class="download-item">
                        Windowsç‰ˆä¸‹è½½
                    </a>
                    <a href="#" class="download-item">
                        Macç‰ˆä¸‹è½½
                    </a>
                </div>
            </div>
            
            <!-- å®˜æ–¹æ¸ é“ -->
            <div class="official-channel">
                <h3 class="channel-header">å®˜æ–¹æ¸ é“</h3>
                <div class="channel-list">
                    <a href="#" class="channel-item">
                        å¾®ä¿¡
                    </a>
                    <a href="#" class="channel-item">
                        å¾®åš
                    </a>
                </div>
            </div>
        </div>

        <!-- å›¾ç‰‡åŒºåŸŸ -->
        <div class="footer-image">
            <img src="img/logo.png" alt="å®£ä¼ å›¾" style="width:250px;height:80px;object-fit:cover;">
        </div>
    </div>
</div>
<div id="accessDeniedToast" style="display: none;">
    å½“å‰è´¦å·æ— å¼€å‘è€…æƒé™ï¼
</div>
</body>

<script>
        // ç™»å½•çŠ¶æ€éªŒè¯
        if (!localStorage.getItem('authToken')) {
        window.location.href = 'index.html';
    }

    // åŠ¨æ€æ˜¾ç¤ºç”¨æˆ·åï¼ˆéœ€è¦åç«¯æ”¯æŒï¼‰
    async function loadUserInfo() {
        try {
            const response = await fetch('/api/user', {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                }
            });
            const user = await response.json();
            document.getElementById('username').textContent = user.username;
        } catch (error) {
            console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
        }
    }

    // ä¿®æ”¹æ£€æŸ¥å¼€å‘è€…æƒé™çš„æ–¹æ³•
    function checkDeveloperAccess(event) {
    event.preventDefault();
    const token = localStorage.getItem('authToken');
    
    if (!token) {
        showCustomAlert('âš ï¸ è¯·å…ˆç™»å½•', 'æ‚¨éœ€è¦ç™»å½•åæ‰èƒ½è®¿é—®å¼€å‘è€…ä¸­å¿ƒ');
        return;
    }

    fetch('/api/check-developer', {
        headers: { 'Authorization': `Bearer ${token}` }
    })
    .then(response => {
        if (response.status === 200) {
            window.location.href = 'kaifa.html';
        } else if (response.status === 403) {
            showAccessDeniedToast(); // æ–°å¢ä¸“ç”¨æç¤ºæ–¹æ³•
        } else {
            showCustomAlert('é”™è¯¯', 'æœªçŸ¥é”™è¯¯ï¼ŒçŠ¶æ€ç ï¼š' + response.status);
        }
    })
    .catch(error => {
        console.error('æƒé™éªŒè¯å¤±è´¥:', error);
        showCustomAlert('é”™è¯¯', 'ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•');
    });
}

// æ–°å¢ä¸“ç”¨æƒé™æç¤º
function showAccessDeniedToast() {
    const toast = document.getElementById('accessDeniedToast');
    toast.style.display = 'block';
    setTimeout(() => {
        toast.style.display = 'none';
    }, 2000);
}

    document.addEventListener('DOMContentLoaded', loadUserInfo);

    const slides = document.querySelectorAll('.slide');
    const totalSlides = slides.length;
    let currentIndex = 0;

    function showSlides() {
        slides.forEach((slide, index) => {
            slide.classList.remove('active'); // æ¸…é™¤æ‰€æœ‰ç¼©æ”¾
            slide.style.transform = `scale(0.8)`; // å…¶ä½™ç¼©å°
        });

        slides[currentIndex].classList.add('active'); // å½“å‰å›¾ç‰‡æ”¾å¤§
        slides[currentIndex].style.transform = `scale(1)`; //ä¿æŒç¼©æ”¾ä¸º1
        updateSlidePosition(); // æ›´æ–°ä½ç½®
    }

    function updateSlidePosition() {
        const offset = -currentIndex * 100; // è®¡ç®—å½“å‰ä½ç½®
        document.querySelector('.slides').style.transform = `translateX(${offset}%)`;
    }

    function nextSlide() {
        currentIndex = (currentIndex + 1) % totalSlides; // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ª
        showSlides();
    }

    function prevSlide() {
        currentIndex = (currentIndex - 1 + totalSlides) % totalSlides; // ç§»åŠ¨åˆ°ä¸Šä¸€ä¸ª
        showSlides();
    }

    document.getElementById('next').addEventListener('click', nextSlide);
    document.getElementById('prev').addEventListener('click', prevSlide);

    // è‡ªåŠ¨æ’­æ”¾
    setInterval(nextSlide, 3000); // æ¯3ç§’è‡ªåŠ¨åˆ‡æ¢

    showSlides(); // åˆå§‹åŒ–

    // ====================== æ–°å¢ Toast æç¤ºç»„ä»¶ ====================== 
const Toast = {
  show: (message, isSuccess = true) => {
    const toast = document.createElement('div');
    toast.className = `custom-toast ${isSuccess ? 'success' : 'error'}`;
    toast.innerHTML = `
      <span>${isSuccess ? 'âœ…' : 'âš ï¸'}</span>
      <p>${message}</p>
    `;
    document.body.appendChild(toast);
    
    setTimeout(() => toast.classList.add('show'), 10);
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 300);
    }, 2000);
  }
};

// ====================== é¢„çº¦æ ¸å¿ƒé€»è¾‘ ======================
const handleReserve = async (button) => {
  const gameId = button.dataset.gameId;
  const gameName = button.dataset.gameName;
  const isReserved = button.textContent.includes('å·²é¢„çº¦');

  try {
    const response = await fetch('/api/reserve', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
      },
      body: JSON.stringify({
        gameId,
        gameName,
        action: isReserved ? 'remove' : 'add'
      })
    });
    const data = await response.json();
    // if (!response.ok) throw new Error('æ“ä½œå¤±è´¥');
    
    // button.textContent = isReserved ? 'ç«‹å³é¢„çº¦' : 'å·²é¢„çº¦';
    // button.style.backgroundColor = isReserved ? '#6c757d' : '#ff6b6b';

    if (data.success) {
      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      button.textContent = isReserved ? 'ç«‹å³é¢„çº¦' : 'å·²é¢„çº¦';
      button.style.backgroundColor = isReserved ? '#6c757d' : '#ff6b6b';
      Toast.show(isReserved ? `å·²å–æ¶ˆé¢„çº¦ ${gameName}` : `æˆåŠŸé¢„çº¦ ${gameName}`);
      // æ›´æ–°é¢„çº¦æ•°æ˜¾ç¤º
      const countElement = document.querySelector(`[data-game-id="${gameId}"]`);
      if (countElement) {
        countElement.textContent = `${data.reserve_count} äººé¢„çº¦`;
      }
    }
  } catch (error) {
    Toast.show(error.message || 'ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•', false);
  }
};

// åˆå§‹åŒ–é¢„çº¦æ•°============================================================
async function initReserveCount() {
  document.querySelectorAll('.reserve-count').forEach(async element => {
    const gameId = element.dataset.gameId;
    try {
      const response = await fetch(`/api/game/reserve-count/${gameId}`);
      const { reserve_count } = await response.json();
      element.textContent = `${reserve_count} äººé¢„çº¦`;
    } catch (error) {
      console.error('åˆå§‹åŒ–é¢„çº¦æ•°å¤±è´¥:', error);
    }
  });
}
// ====================== åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€ ======================
const initReserveButtons = async () => {
  try {
    const response = await fetch('/api/library', {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
      }
    });
    
    const { reservations } = await response.json();
    document.querySelectorAll('.reserve-btn').forEach(button => {
      const gameId = button.dataset.gameId;
      const isReserved = reservations.some(r => r.id === gameId);
      
      if (isReserved) {
        button.textContent = 'å·²é¢„çº¦';
        button.style.backgroundColor = '#ff6b6b';
      }
    });
  } catch (error) {
    Toast.show('åˆå§‹åŒ–æ•°æ®å¤±è´¥', false);
  }
};


// ä¿®æ”¹DOMContentLoadedäº‹ä»¶
document.addEventListener('DOMContentLoaded', () => {
  initReserveButtons();
  initReserveCount(); // æ–°å¢åˆå§‹åŒ–
  loadUserInfo();
});

// åœ¨æ¸¸æˆå¡ç‰‡æ¸²æŸ“æ—¶æ·»åŠ 
function renderGameCard(game) {
  const card = document.createElement('div');
  card.className = 'game-card';
  card.innerHTML = `
    <img src="${game.cover}" 
         onmouseover="showGameDetail('${game.id}')"
         onmouseout="hideGameDetail()">
    <!-- å…¶ä»–å†…å®¹ -->
  `;
  return card;
}

// ====================== äº‹ä»¶ç»‘å®š ======================
document.querySelectorAll('.reserve-btn').forEach(button => {
  button.addEventListener('click', () => handleReserve(button));
});

// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', initReserveButtons);


    const imageContainer = document.querySelector('.date3');
    const hoverDiv = document.querySelector('.hover-div');
    imageContainer.addEventListener('mouseover', function() {
        hoverDiv.style.opacity = '1'; // ä½¿<div>å®Œå…¨å¯è§
        hoverDiv.style.visibility = 'visible'; // è®¾ç½®ä¸ºå¯è§
    });
    imageContainer.addEventListener('mouseout', function() {
        hoverDiv.style.opacity = '0'; // ä½¿<div>å®Œå…¨éšå½¢
        hoverDiv.style.visibility = 'hidden'; // è®¾ç½®ä¸ºä¸å¯è§
    });



    const imgContainer = document.querySelector('.date3-1');
    const hoverDiv2 = document.querySelector('.hover-div2');

    imgContainer.addEventListener('mouseover', function() {
        hoverDiv2.style.opacity = '1'; // ä½¿<div>å®Œå…¨å¯è§
        hoverDiv2.style.visibility = 'visible'; // è®¾ç½®ä¸ºå¯è§
    });
    imgContainer.addEventListener('mouseout', function() {
        hoverDiv2.style.opacity = '0'; // ä½¿<div>å®Œå…¨éšå½¢
        hoverDiv2.style.visibility = 'hidden'; // è®¾ç½®ä¸ºä¸å¯è§
    });



    const imgContainer3 = document.querySelector('.date3-3');
    const hoverDiv3 = document.querySelector('.hover-div3');

    imgContainer3.addEventListener('mouseover', function() {
        hoverDiv3.style.opacity = '1'; // ä½¿<div>å®Œå…¨å¯è§
        hoverDiv3.style.visibility = 'visible'; // è®¾ç½®ä¸ºå¯è§
    });

    imgContainer3.addEventListener('mouseout', function() {
        hoverDiv3.style.opacity = '0'; // ä½¿<div>å®Œå…¨éšå½¢
        hoverDiv3.style.visibility = 'hidden'; // è®¾ç½®ä¸ºä¸å¯è§
    });



    const imgContainer4 = document.querySelector('.date3-4');
    const hoverDiv4 = document.querySelector('.hover-div4');

    imgContainer4.addEventListener('mouseover', function() {
        hoverDiv4.style.opacity = '1'; // ä½¿<div>å®Œå…¨å¯è§
        hoverDiv4.style.visibility = 'visible'; // è®¾ç½®ä¸ºå¯è§
    });

    imgContainer4.addEventListener('mouseout', function() {
        hoverDiv4.style.opacity = '0'; // ä½¿<div>å®Œå…¨éšå½¢
        hoverDiv4.style.visibility = 'hidden'; // è®¾ç½®ä¸ºä¸å¯è§
    });



    const imgContainer5 = document.querySelector('.date3-5');
    const hoverDiv5 = document.querySelector('.hover-div5');

    imgContainer5.addEventListener('mouseover', function() {
        hoverDiv5.style.opacity = '1'; // ä½¿<div>å®Œå…¨å¯è§
        hoverDiv5.style.visibility = 'visible'; // è®¾ç½®ä¸ºå¯è§
    });

    imgContainer5.addEventListener('mouseout', function() {
        hoverDiv5.style.opacity = '0'; // ä½¿<div>å®Œå…¨éšå½¢
        hoverDiv5.style.visibility = 'hidden'; // è®¾ç½®ä¸ºä¸å¯è§
    });
</script>
</html>